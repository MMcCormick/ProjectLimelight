<% content_for :sidebar_right do %>
  <%#= render_cell(:topic, :sidebar, current_user, @topic, @connections) %>
<% end %>

<% content_for :head do %>
  <link type="text/css" rel="stylesheet" href="http://freebaselibs.com/static/suggest/1.3/suggest.min.css" />
<% end %>

<% content_for :js do %>
  <script type="text/javascript" src="http://freebaselibs.com/static/suggest/1.3/suggest.min.js"></script>
<% end %>

<div class="section">
  <h3>Edit Topic Info</h3>
  <%= render 'form' %>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Change Default Image</h3>
  <%= image_tag topic_default_picture(@topic, 100, 100, 'fit'), :style => "max-width: 100px;", :class => 'topic-image', :alt => "" %>
  <div class="upload" id="topic_uploadB">Upload Image</div>
  <div id="topic_uploadB_progress"></div>
  <% content_for :js do %>
    <%= render "topics/image_upload_js" %>
  <% end %>

  <h4>Use Image From Google</h4>
  <div class='ac fetch-google-images' data-m='get' data-url='<%= topic_google_images_path(@topic) %>'>Fetch Images</div>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Use Freebase</h3>
  <% if @topic.fb_id %>
    <div id="freebase-lookup-id" data-id="<%= @topic.fb_id %>">Connected to freebase topic '<%= @topic.fb_id %>' <span>[re-fetch info]</span></div>
  <% end %>
  <div class="field">
    <h5>Search freebase topics</h5>
    <%= text_field_tag "freebase", @topic.name, :id => "freebase-ac", "data-url" => freebase_lookup_path(@topic), :spellcheck => false, :autocomplete => 'off' %>
  </div>

  <div id="freebase-form-c"></div>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Edit Topic Connections</h3>
  <%#= render_cell :topic, :add_connection, @topic %>
  <div class="clear-left"></div>
  <div class="topic-connections">
    <% @connections.each do |type, data| %>
      <div class="connection">
        <h5><%= type %></h5>
        <% data['connections'].each do |connection| %>
          <div class="con-topic">
            <%= render 'topics/tag', :topic => TopicSnippet.new(connection), :include_image => false %>

            <% if type == 'Type Of' %>
              <%= render 'topic_connections/toggle_primary_btn', :snippet => connection, :topic_id => @topic.id %>
            <% end %>

            <a data-url="<%= remove_connection_path %>" data-d='{ "id":"<%= data['connection_id'] %>", "topic1_id":"<%= @topic.id %>", "topic2_id":"<%= connection['uuid'] %>" }'
               data-m="delete" class="ac delete">[delete]</a>
          </div>
          <div class="clear-left"></div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Edit Aliases</h3>
  <% @topic.aliases.each do |topic_alias| %>
    <div class="alias">
      <div class='name'><%= topic_alias.name %></div>
      <%= render 'topics/ooac_btn', :topic => @topic, :topic_alias => topic_alias %>
      <div class='ac' data-url='<%= destroy_topic_alias_path(@topic, :name => topic_alias.name) %>' data-m='delete'>[delete]</div>
    </div>
  <% end %>
  <%= render "topics/add_alias_form", :topic => @topic %>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Lock Topic Slug</h3>
  <%= render "topics/lock_slug_form", :topic => @topic %>
</div>
<div class="clear-left"></div>

<div class="section">
  <h3>Merge Into a Topic</h3>
  <%= render "topics/merge_form", :topic => @topic %>
</div>
