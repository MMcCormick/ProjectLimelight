<!doctype html>
  <!--[if lt IE 7]> <html class="no-js ie6 oldie" xmlns:fb="http://ogp.me/ns/fb#" lang="en"> <![endif]-->
  <!--[if IE 7]>    <html class="no-js ie7 oldie" xmlns:fb="http://ogp.me/ns/fb#" lang="en"> <![endif]-->
  <!--[if IE 8]>    <html class="no-js ie8 oldie" xmlns:fb="http://ogp.me/ns/fb#" lang="en"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js" xmlns:fb="http://ogp.me/ns/fb#" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title><%= title %></title>

    <meta name="description" content="<%= description %>">
    <meta name="author" content="">

    <!-- Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <%= stylesheet_link_tag "application" %>
    <!--[if lt IE 9]><%= stylesheet_link_tag "ie" %><![endif]-->

    <%= csrf_meta_tags %>

    <%= yield :head %>

    <%= javascript_include_tag 'modernizr' %>
  </head>
  <body id="<%= params[:controller].parameterize %>-c" class="<%= site_style %>">
    
    <%= render 'shared/header' %>

    <div id="colmask" class="<%= right_sidebar %>">
      <div id="colmid">
        <div id="page">
          <div id="page_content" class="<%= params[:action].parameterize %>-c">
            <div id="page_inside">
              <div id="page_header">
                <%- flash.each do |name, msg| -%>
                  <%= content_tag :div, msg, :id => "flash_#{name}" if msg.is_a?(String) %>
                <%- end -%>
                <%= yield :page_header %>
              </div>

              <%= yield %>

              <% if Rails.env.development? %>
                <%= debug(params) %>
                <div id="debug-upload-runtime">Upload Runtime: No runtime found</div>
              <% end %>
            </div>
          </div>

          <div class="sidebar left">
            <%= render_cell :user, :sidebar, current_user, current_user, '' %>

            <div id="static-links">
              <a href="/pages/about">About</a> <span class="dot">.</span>
              <a href="/pages/contact">Contact</a> <span class="dot">.</span>
              <a href="/pages/privacy">Privacy</a>
              <br>
              <a href="/pages/terms">Terms</a> <span class="dot">.</span>
              <a href="/pages/help">Help</a> <span class="dot">.</span>
              <span data-m="put" data-url="/help/tutorials/on" class="tutorial-start <%= signed_in? ? 'ac' : 'auth' %>">Tutorials</span>
            </div>
          </div>
          
          <div class="sidebar right">
            <%= yield :sidebar_right %>
          </div>
        </div>
      </div>
    </div>

    <footer id="footer">
      <div class="interior">
        <%= render_cell :topic, :trending %>
        <div id="twitter-footer">
          <a href="https://twitter.com/limelight_team" class="twitter-follow-button" data-button="grey" data-text-color="#FFFFFF" data-link-color="#FFF" data-show-count="false" data-width="160px" data-align="right">Follow @limelight_team</a>
          <script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
        </div>
        <div id="fb-footer">
          <fb:like href="http://www.facebook.com/pages/Limelight/240530529343415" send="false" layout="button_count" width="90" show_faces="false" font="tahoma"></fb:like>
        </div>
      </div>
      <div id="plt"><%= load_time %></div>
    </footer>

    <!-- HIDDEN TOOLS -->
    <div id="mouse-score"></div>
    <%= render "shared/contribute", :id => 'top-contribute', :responding => nil %>
    <div id="form-submitting">Form submitting...</div>
    <div style="display: none">
      <div id="static-data" data-d='<%= static_data %>' <%= "data-push='#{current_user.id}_private'" if signed_in? %>></div>
      <div id="feed-reload" data-url='<%= request.url %>' class='ac'></div>
      <%= render "core_object_shares/form" %>
      <%= render 'users/auth_box', :show => nil %>
      <% if signed_in? && current_user.username_reset %>
        <%= render 'users/username_reset_box' %>
      <% end %>
    </div>

    <%= new_user_splash %>

    <%= render 'help/panel' %>

    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/javascripts/jquery1.6.4.js"><\/script>')</script>

    <script src="http://js.pusherapp.com/1.9/pusher.min.js"></script>
    <script>window.Pusher || document.write('<script src="/assets/javascripts/pusher1.9.6.min.js"><\/script>')</script>
    <script type="text/javascript">
      <% unless Rails.env.production? %>
        Pusher.log = function(message) {
          if (window.console && window.console.log) window.console.log(message);
        };

        // Flash fallback logging - don't include this in production
        WEB_SOCKET_DEBUG = true;
      <% end %>

      var pusher = new Pusher('<%= Pusher.key %>');
    </script>

    <%= javascript_include_tag "application" %>
    <%= yield :js %>

    <!-- GOOGLE ANALYTICS -->
    <script type="text/javascript">
      <% unless Rails.env.development? %>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-26840635-1']);
        _gaq.push(['_setDomainName', '<%= Rails.env.production? ? 'projectlimelight.com' : 'staging.projectlimelight.com' %>']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      <% end %>
    </script>

    <!-- Start of Woopra Code -->
    <% unless Rails.env.development? %>
      <script type="text/javascript">
        function woopraReady(tracker) {
          tracker.setDomain('<%= Rails.env.production? ? 'projectlimelight.com' : 'staging.projectlimelight.com' %>');
          tracker.setIdleTimeout(300000);

          <% if signed_in? %>
              tracker.addVisitorProperty('name', '<%= current_user.username %>');
              tracker.addVisitorProperty('email', '<%= current_user.email %>');
          <% end %>

          tracker.addVisitorProperty('feed layout', '<%= session[:feed_filters][:layout] %>');
          tracker.addVisitorProperty('feed sort', '<%= session[:feed_filters][:sort]['target'] %>');
          tracker.addVisitorProperty('feed show', '<%= session[:feed_filters][:display].join(', ') %>');

          tracker.track();

          return false;
        }
        (function() {
            var wsc = document.createElement('script');
            wsc.src = document.location.protocol+'//static.woopra.com/js/woopra.js';
            wsc.type = 'text/javascript';
            wsc.async = true;
            var ssc = document.getElementsByTagName('script')[0];
            ssc.parentNode.insertBefore(wsc, ssc);
        })();
      </script>
    <% end %>

    <div id="fb-root"></div>
      <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  </body>
</html>
